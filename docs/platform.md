# Platform Mode Usage

Platform mode allows you to use MCLIB2's build system and platform adapters without the full annotation framework. This is ideal for simple plugins or when you want to use your own dependency injection system.

## Gradle Plugin Setup

Add the MCLIB2 Gradle plugin to your `build.gradle`:

```gradle
plugins {
    id 'java'
    id 'mclib2-plugin'
}

repositories {
    mavenCentral()
    maven {
        name = "spigot"
        url = uri("https://hub.spigotmc.org/nexus/content/repositories/snapshots/")
    }
}

dependencies {
    // For Bukkit plugins
    compileOnly 'org.bukkit:bukkit:1.8.8-R0.1-SNAPSHOT'
}
```

**Note**: When using platform mode, you don't need to configure the `mclib2 {}` extension block. The plugin will automatically provide the necessary platform dependencies.

## Platform Entrypoints

### Creating Entrypoint Classes

**Important**: You need separate entrypoint classes for Bukkit and standalone modes because the `JavaPlugin` class is not available in standalone mode and will cause `ClassNotFoundException`.

#### Bukkit Mode Entrypoint

```java
package com.example.myplugin;

import be.theking90000.mclib2.platform.PlatformEntrypoint;
import org.bukkit.plugin.java.JavaPlugin;

public class BukkitPlugin {
    
    @PlatformEntrypoint
    public BukkitPlugin(JavaPlugin plugin) {
        // Bukkit mode - JavaPlugin parameter required
        plugin.getLogger().info("Plugin initialized in Bukkit mode: " + plugin.getName());
        plugin.getServer().getPluginManager().registerEvents(new MyListener(), plugin);
    }
    
    @PlatformEntrypoint
    public BukkitPlugin() {
        // Alternative: no-parameter constructor for Bukkit mode
        System.out.println("Bukkit plugin loaded without JavaPlugin access!");
    }
}
```

#### Standalone Mode Entrypoint

```java
package com.example.myplugin;

import be.theking90000.mclib2.platform.PlatformEntrypoint;

public class StandalonePlugin {
    
    @PlatformEntrypoint
    public StandalonePlugin() {
        // Standalone mode - no parameters
        System.out.println("Plugin initialized in standalone mode");
        initializeStandalone();
    }
    
    private void initializeStandalone() {
        // Your standalone initialization logic
        System.out.println("Running standalone application logic");
    }
}
```

### Entrypoints Registration

**Important**: You must create an `entrypoints.txt` file in your `src/main/resources/` directory listing **both** your entrypoint classes:

```
src/main/resources/entrypoints.txt
```

Content:
```
com.example.myplugin.BukkitPlugin
com.example.myplugin.StandalonePlugin
```

Each line should contain the fully qualified class name of a class with `@PlatformEntrypoint` constructors. MCLIB2 will automatically choose the appropriate class based on the runtime platform.

## Build Tasks

The MCLIB2 Gradle plugin provides specialized build tasks for different platforms:

### `bukkitJar` Task

Produces a Bukkit-compatible plugin JAR:

```bash
./gradlew bukkitJar
```

**Output**: `build/libs/yourproject-bukkit-version.jar`

This task:
- Includes the Bukkit platform adapter
- Generates the appropriate `plugin.yml` manifest
- Automatically sets the `main` property in `plugin.yml` to the MCLIB2 bootstrap class
- Packages your entrypoint classes and resources

### `standaloneJar` Task

Produces a standalone executable JAR:

```bash
./gradlew standaloneJar
```

**Output**: `build/libs/yourproject-standalone-version.jar`

This task:
- Includes the standalone platform adapter
- Sets up the main class for standalone execution
- Packages all dependencies needed for standalone operation

## Bukkit Plugin Configuration

### plugin.yml Requirements

For Bukkit plugins, you must provide a `plugin.yml` file in `src/main/resources/`:

```yaml
# src/main/resources/plugin.yml
name: MyPlugin
version: 1.0.0
description: My awesome plugin
author: YourName

# DO NOT set 'main' - it's automatically generated by MCLIB2
# main: will be set to MCLIB2's platform bootstrap class

depend: []
softdepend: []
```

**Important**: 
- The `main` property is automatically generated and should **not** be specified
- MCLIB2 will set it to its internal bootstrap class that handles platform initialization
- All other standard `plugin.yml` properties can be configured normally

### Optional JavaPlugin Parameter

In Bukkit mode, the `@PlatformEntrypoint` constructor can optionally receive a `JavaPlugin` parameter:

```java
@PlatformEntrypoint
public BukkitPlugin(JavaPlugin plugin) {
    // Access Bukkit plugin instance
    plugin.getLogger().info("Plugin data folder: " + plugin.getDataFolder());
    plugin.getServer().getPluginManager().registerEvents(new MyListener(), plugin);
}
```

If you don't need access to the JavaPlugin instance, you can use a no-argument constructor:

```java
@PlatformEntrypoint
public BukkitPlugin() {
    // Simple initialization without JavaPlugin access
    System.out.println("Bukkit plugin loaded!");
}
```

## Example Project Structure

```
my-plugin/
├── build.gradle
├── src/
│   └── main/
│       ├── java/
│       │   └── com/example/myplugin/
│       │       ├── BukkitPlugin.java        # Bukkit mode entrypoint
│       │       ├── StandalonePlugin.java    # Standalone mode entrypoint
│       │       └── SharedLogic.java         # Common business logic
│       └── resources/
│           ├── entrypoints.txt              # Required: lists both entrypoint classes
│           └── plugin.yml                   # Required for Bukkit: standard plugin config
└── build/
    └── libs/
        ├── my-plugin-bukkit-1.0.0.jar      # From bukkitJar task
        └── my-plugin-standalone-1.0.0.jar  # From standaloneJar task
```

### Sharing Code Between Platforms

To avoid code duplication, extract your common logic into shared classes:

```java
// SharedLogic.java - Common business logic
public class SharedLogic {
    public void performCommonTask() {
        System.out.println("Executing shared business logic");
    }
}

// BukkitPlugin.java - Bukkit-specific entrypoint
public class BukkitPlugin {
    @PlatformEntrypoint
    public BukkitPlugin(JavaPlugin plugin) {
        SharedLogic logic = new SharedLogic();
        logic.performCommonTask();
        
        // Bukkit-specific initialization
        plugin.getLogger().info("Bukkit plugin initialized");
    }
}

// StandalonePlugin.java - Standalone-specific entrypoint  
public class StandalonePlugin {
    @PlatformEntrypoint
    public StandalonePlugin() {
        SharedLogic logic = new SharedLogic();
        logic.performCommonTask();
        
        // Standalone-specific initialization
        System.out.println("Standalone application initialized");
    }
}
```

This platform mode setup gives you the flexibility of MCLIB2's build system and multi-platform support without requiring the full annotation framework.
